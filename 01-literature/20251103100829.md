---
title: Kap 3.3.4 En indre iteratorklasse
id: 20251103100901
tags: []
---

# [Kap 3.3.4]([[20250818102829]]) En indre iteratorklasse
En **iteratorklasse** gjør det mulig å traversere en lenket liste element for element på en trygg måte.\
Den skal være en **privat indre klasse** i `EnkeltLenketListe` og implementere `Iterator<T>`.

Hensikten er å gi brukeren en standardisert måte å gå gjennom elementene på uten å eksponere liste­strukturen direkte.

## Grunnstruktur
```java
private class EnkeltLenketListeIterator implements Iterator<T> {
    private Node<T> p = hode;
    private boolean fjernOK = false;
    private int iteratorendringer = endringer;

    public boolean hasNext() {
        return p != null;
    }

    public T next() {
        if (iteratorendringer != endringer)
            throw new ConcurrentModificationException();
        if (!hasNext())
            throw new NoSuchElementException("Ingen verdier!");
        fjernOK = true;
        T verdi = p.verdi;
        p = p.neste;
        return verdi;
    }

    public void remove() {
        if (!fjernOK)
            throw new IllegalStateException("Ulovlig tilstand!");
        if (iteratorendringer != endringer)
            throw new ConcurrentModificationException();
        fjernOK = false;

        Node<T> q = hode;
        if (hode.neste == p) {
            hode = hode.neste;
            if (p == null) hale = null;
        } else {
            Node<T> r = hode;
            while (r.neste.neste != p) r = r.neste;
            q = r.neste;
            r.neste = p;
            if (p == null) hale = r;
        }
        q.verdi = null;
        q.neste = null;
        antall--;
        endringer++;
        iteratorendringer++;
    }
}
```
## Metoden `iterator()`
Returnerer en ny instans av iteratoren slik at `for-each`-løkker og manuell iterasjon fungerer:
```java
public Iterator<T> iterator() {
    return new EnkeltLenketListeIterator();
}
```

## Viktige konsepter
* **`p`**: peker til gjeldende node
* **`fjernOK`**: styrer om `remove()` er lovlig å kalle (kun etter `next()`)
* **`endringer` / `iteratorendringer`**: beskytter mot samtidige modifikasjoner
  * Hvis listen endres utenfor iteratoren → `ConcurrentModificationException`
* **`remove()`** fjerner verdien som ble returnert av siste `next()`

## Oppsummering

Den indre iteratoren gjør:
* Traversering av listen uten direkte tilgang til nodene
* Sikkerhet mot feil bruk via tilstandsvariabler
* Beskyttelse mot uventede endringer i listen
Dette er et klassisk eksempel på **fail-fast iterator**, brukt i de fleste Java-samlinger.
